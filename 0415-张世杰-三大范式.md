

# **三大范式**

### 为了建立（rong）冗余较小、结构合理的数据库，设计数据库时必须遵循一定的规则。在关系型数据库中这种规则就称为范式。范式是符合某一种设计要求的总结。要想设计一个结构合理的关系型数据库，必须满足一定的范式。

## **一、三大范式**

### 1.第一范式（1NF）

第一范式是最基本的范式。如果数据库表中的所有字段值都是不可分解的原子值，就说明该数据库表满足了第一范式。

原子性：强调的是列的原子性，即数据库中每一列的字段都是单一属性，不可再分的。并且这个单一属性必须是由基本的数据类型所构成的，如整数、字符串等。

|           地址           |
| :----------------------: |
| 大森林，狗熊岭，强哥山庄 |



|   省   |   市   | 具体地址 |
| :----: | :----: | :------: |
| 大森林 | 狗熊岭 | 强哥山庄 |

第一种表设计不满足[第一范式](https://so.csdn.net/so/search?q=第一范式&spm=1001.2101.3001.7020)，为什么不满足第一范式？因为`地址`列不具有原子性，能拆分成`省份`、`市`和`具体地址`；

### 2.第二范式（2NF）

第二范式在第一范式的基础之上更进一层。第二范式需要确保数据库表中的每一列都和主键相关，而不能只与主键的某一部分相关（主要针对联合主键而言）。也就是说在一个数据库表中，一个表中只能保存一种数据，不可以把多种数据保存在同一张数据库表中。

依赖性：在满足1NF的基础上再满足依赖性的两个[约束](https://so.csdn.net/so/search?q=约束&spm=1001.2101.3001.7020)：一张表必须有一个主键；非主键类必须完全依赖于主键，而不能只依赖主键的一部分。

例如：选课只描述课程相关的信息，所以所有字段都必须与学号id相关    

人员表只描述与人员相关的信息，所以所有字段都必须与学号id相 关；

| 学号 | 姓名   | 系名 | 系主任 | 课程名             | 分数 |
| ---- | ------ | ---- | ------ | ------------------ | ---- |
| 001  | 熊大   | 软件 | 吉吉   | 《如何打败光头强》 | 60   |
| 001  | 熊大   | 软件 | 吉吉   | 《如何追到翠花》   | 100  |
| 002  | 熊二   | 机电 | 毛毛   | 《如何打败光头强》 | 30   |
| 002  | 熊二   | 机电 | 毛毛   | 《如何追到翠花》   | 50   |
| 003  | 光头强 | 现管 | 肥波   | 《如何打败光头强》 | 80   |
| 003  | 光头强 | 现管 | 肥波   | 《如何追到翠花》   | 20   |

选课表：

| 学号 | 课程名             | 分数 |
| ---- | ------------------ | ---- |
| 001  | 《如何打败光头强》 | 60   |
| 001  | 《如何追到翠花》   | 100  |
| 002  | 《如何打败光头强》 | 30   |
| 002  | 《如何追到翠花》   | 50   |
| 003  | 《如何打败光头强》 | 80   |
| 003  | 《如何追到翠花》   | 20   |

###### 人员表：

| 学号 | 姓名   | 系名 | 系主任 |
| ---- | ------ | ---- | ------ |
| 001  | 熊大   | 软件 | 吉吉   |
| 001  | 熊大   | 软件 | 吉吉   |
| 002  | 熊二   | 机电 | 毛毛   |
| 002  | 熊二   | 机电 | 毛毛   |
| 003  | 光头强 | 现管 | 肥波   |
| 003  | 光头强 | 现管 | 肥波   |



### 3.第三范式（3NF）

在满足2NF的基础上，另外再满足一个条件：非主键列必须直接依赖于主键，不能存在传递依赖。

**外键约束！！！**

表中的所有数据元素不但要能惟一地被主关键字所标识,而且它们之间还必须相互独立,不存在其他的函数关系。也就是说，对于一个满足2 NF 的数据结构来说，表中有可能存在某些数据元素依赖于其他非关键字数据元素的现象,必须消除。

选课表：

| 学号 | 课程名             | 分数 |
| ---- | ------------------ | ---- |
| 001  | 《如何打败光头强》 | 60   |
| 001  | 《如何追到翠花》   | 100  |
| 002  | 《如何打败光头强》 | 30   |
| 002  | 《如何追到翠花》   | 50   |
| 003  | 《如何打败光头强》 | 80   |
| 003  | 《如何追到翠花》   | 20   |

人员表：

| 学号 | 姓名   | 系名 |
| ---- | ------ | ---- |
| 001  | 熊大   | 软件 |
| 002  | 熊二   | 机电 |
| 003  | 光头强 | 现管 |

系表：

| 系名 | 系主任 |
| ---- | ------ |
| 软件 | 吉吉   |
| 机电 | 毛毛   |
| 现管 | 肥波   |

就比如说这个表是学生表，学生表中有学号，姓名等字段，那如果要把他的系编号，系主任，系主任也存到这个学生表中，那就会造成数据大量的冗余，一是这些信息在系信息表中已存在，二是系中有1000个学生的话这些信息就要存1000遍。因此第三范式的做法是在学生表中增加一个系编号的字段（外键），与系信息表做关联。
在表中，一个`系名`能确定一个`系主任`。这样，`系名`依赖于`学号`和`(学生)姓名`，而`系主任`又依赖于`系名`，这就导致了传递依赖，3NF就是消除这种依赖。

#### 注意事项：

1.第二范式与第三范式的本质区别：在于有没有分出两张表。

第二范式是说一张表中包含了多种不同实体的属性，那么必须要分成多张表，第三范式是要求已经分好了多张表的话，一张表中只能有另一张标的ID，而不能有其他任何信息，（其他任何信息，一律用主键在另一张表中查询）。

2.必须先满足第一范式才能满足第二范式，必须同时满足第一第二范式才能满足第三范式。

三大范式只是一般设计数据库的基本理念，可以建立冗余较小、结构合理的数据库。如果有特殊情况，当然要特殊对待，数据库设计最重要的是看需求跟性能，需求>性能>表结构。所以不能一味的去追求范式建立数据库。

## 二、五大约束

所谓约束，其实就是一种保障，比如一个属性添加了[主键约束](https://so.csdn.net/so/search?q=主键约束&spm=1001.2101.3001.7020)，那么就强制保障了它的唯一性和非空性，请带着这样正确的理解去阅读后文。

### 1、主键约束（Primay Key）

> 唯一性，非空性

主关键字约束指定表的一列或几列的组合的值在表中具有惟一性，即能惟一地指定一行记录。每个表中只能有一列被指定为主关键字，且IMAGE 和TEXT 类型的列不能被指定为主关键字，也不允许指定主关键字列有NULL 属性。

### 2、唯一约束 （Unique）

> 唯一性，可以空，但只能有一个

惟一性约束指定一个或多个列的组合的值具有惟一性，以防止在列中输入重复的值。惟一性约束指定的列可以有NULL 属性。由于主关键字值是具有惟一性的，因此主关键字列不能再设定惟一性约束。惟一性约束最多由16 个列组成

### 3、检查约束 (Check)

> 对该列数据的范围、格式的限制（如：年龄、性别等）

检查约束对输入列或整个表中的值设置检查条件，以限制输入值，保证数据库的数据完整性。可以对每个列设置复合检查。

### 4、默认约束 (Default)

> 该数据的默认值

默认约束也是表定义的一个组成部分，它定义了**当插入的行对于定义了默认约束的列未提供相应数据是该怎么办**。 可以定义一个字面值（年龄默认为0）或系统值（getdate ()）等。

### 5、外键约束 (Foreign Key)

> 需要建立两表间的关系

外关键字约束定义了表之间的关系。当一个表中的一个列或多个列的组合和其它表中的主关键字定义相同时，就可以将这些列或列的组合定义为外关键字，并设定它适合哪个表中哪些列相关联。

### 语法示例

1、添加主键约束（将UserId作为主键）
alter table UserId
add constraint AA_UserId primary key (UserId)

2、添加唯一约束（身份证号唯一，因为每个人的都不一样）
alter table UserInfo
add constraint AB_IDNumber unique(IdentityCardNumber)

3、添加默认约束（如果地址不填 默认为“地址不详”）
alter table UserInfo
add constraint AC_UserAddress default (‘地址不详’) for UserAddress

4、添加检查约束 （对年龄加以限定 20-40岁之间）
alter table UserInfo
add constraint AD_UserAge check (UserAge between 20 and 40)
alter table UserInfo
add constraint AD_UserSex check (UserSex=’男’ or UserSex=’女′)

5、添加外键约束 (主表UserInfo和从表UserOrder建立关系，关联字段UserId)
alter table UserOrder
add constraint AF_UserId_UserId foreign key(UserId)references UserInfo(UserId)